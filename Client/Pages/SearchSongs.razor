@page "/SearchSongs"
@using music_manager_starter.Shared

@inject HttpClient Http

@code {
    private List<Song> songs;
    public List<Song> filtered_songs;
    protected override async Task OnInitializedAsync()
    {
        songs = await Http.GetFromJsonAsync<List<Song>>("api/songs");
        filtered_songs = songs;
    }

    void UpdateFilteredSongs(string search_term)
    {
        if(string.IsNullOrEmpty(search_term))
        {
            filtered_songs = songs;
        }
        else
        {
            filtered_songs = songs.Where(
                (song) => song.Title.Contains(search_term, StringComparison.OrdinalIgnoreCase) ||
                song.Artist.Contains(search_term, StringComparison.OrdinalIgnoreCase) ||
                song.Album.Contains(search_term, StringComparison.OrdinalIgnoreCase)
            ).ToList();
            StateHasChanged();
        }
    }
}

<div class="w-100">
    <SearchBox items="songs" on_search="UpdateFilteredSongs"></SearchBox>
</div>
<div class="flex flex-col">
  <div class="-m-1.5 overflow-x-auto">
    <div class="p-1.5 min-w-full inline-block align-middle">
      <div class="overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
          <thead>
            <tr>
              <th scope="col" class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Song</th>
              <th scope="col" class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Artist</th>
              <th scope="col" class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Album</th>
              <th scope="col" class="px-6 py-3 text-end text-xs font-medium text-gray-500 uppercase">Genre</th>
            </tr>
            </thead>
            <tbody>
            @foreach (var song in filtered_songs)
                {
                    <tr class="odd:bg-white even:bg-gray-100">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">@song.Title</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">@song.Artist</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">@song.Album</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">@song.Genre</td>
                    </tr>
                }       
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>